---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import Header from '../components/Header.astro';
import StickySection from '../components/StickySection.astro';
import BusinessOutcomes from '../components/BusinessOutcomes.astro';
import Showcase from '../components/Showcase.astro';
import WhyCompaniesFinal from '../components/WhyCompaniesFinal.astro';
import Pricing from '../components/Pricing.astro';
import Footer from '../components/Footer.astro';
import { EXTERNAL_EMAILS, EXTERNAL_SOCIAL, EXTERNAL_URLS } from '../lib/external';
import CtaImage from '../images/web-image-cta-new.png';
import { getImage } from 'astro:assets';
import { buildSeo, defaultHomeSeo } from '../lib/seo';

// Optimize CTA image (below the fold, so lazy loading is fine)
const ctaImages = {
    webp: await getImage({ src: CtaImage, format: 'webp', width: 420, quality: 80 }),
    original: CtaImage
}

// SEO configuration
const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://gamelayer.io';
const seo = buildSeo({
	...defaultHomeSeo,
	pathname: '/'
});

// Structured data schemas
const schemas = [
	// Organization
	{
		"@context": "https://schema.org",
		"@type": "Organization",
		"name": "GameLayer",
		"url": siteUrl,
		"logo": `${siteUrl}/logo.png`,
		"description": "The leading Gamification API platform for user engagement, retention, and customer loyalty",
		"foundingDate": "2012",
		"address": {
			"@type": "PostalAddress",
			"addressCountry": "FI",
			"addressLocality": "Finland"
		},
		"contactPoint": {
			"@type": "ContactPoint",
			"email": EXTERNAL_EMAILS.CONTACT,
			"contactType": "customer service"
		},
		"sameAs": [
			EXTERNAL_SOCIAL.LINKEDIN,
			EXTERNAL_SOCIAL.TWITTER,
			EXTERNAL_SOCIAL.INSTAGRAM
		]
	},
	// WebSite
	{
		"@context": "https://schema.org",
		"@type": "WebSite",
		"name": "GameLayer",
		"url": siteUrl,
		"description": "Gamification API for modern products",
		"publisher": {
			"@type": "Organization",
			"name": "GameLayer"
		}
	},
	// WebPage (home)
	{
		"@context": "https://schema.org",
		"@type": "WebPage",
		"@id": `${siteUrl}/#webpage`,
		"url": siteUrl,
		"name": seo.title,
		"description": seo.description,
		"isPartOf": {
			"@type": "WebSite",
			"name": "GameLayer",
			"url": siteUrl
		},
		"about": {
			"@type": "Thing",
			"name": "Gamification API"
		}
	},
	// SoftwareApplication (PRIMARY - Enhanced with featureList)
	{
		"@context": "https://schema.org",
		"@type": "SoftwareApplication",
		"name": "GameLayer",
		"url": siteUrl,
		"logo": `${siteUrl}/logo.png`,
		"description": "GameLayer is a Gamification API for digital engagement, loyalty and retention. Launch missions, streaks, leaderboards, rewards and achievements in days—via a flexible REST API.",
		"applicationCategory": "BusinessApplication",
		"operatingSystem": "Web",
		"alternateName": [
			"Gamification Platform",
			"Engagement Platform",
			"Loyalty Platform",
			"منصة التلعيب",
			"نظام نقاط ومكافآت",
			"منصة ولاء العملاء"
		],
		"keywords": [
			"gamification",
			"gamification API",
			"engagement platform",
			"loyalty software",
			"rewards platform",
			"retention platform",
			"منصة التلعيب",
			"نظام ولاء",
			"مكافآت رقمية",
			"نظام نقاط",
			"برامج ولاء العملاء"
		],
		"featureList": [
			"Missions",
			"Streaks",
			"Achievements",
			"Level-Ups",
			"Leaderboards",
			"Mystery Wins",
			"Prizes",
			"Raffles",
			"Quizzes",
			"Virtual Currencies",
			"Rules Manager",
			"Content dashboard",
			"Open API"
		],
		"offers": {
			"@type": "Offer",
			"price": "0",
			"priceCurrency": "EUR",
			"availability": "https://schema.org/InStock"
		}
	},
	// FAQPage (invisible, code-only for AI visibility)
	{
		"@context": "https://schema.org",
		"@type": "FAQPage",
		"mainEntity": [
			{
				"@type": "Question",
				"name": "What is a gamification API?",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "A gamification API is a REST API that provides gamification mechanics—such as missions, streaks, leaderboards, rewards, and achievements—as programmable services. GameLayer's API allows developers to integrate engagement, retention, and loyalty features into existing products without hard-coding game logic."
				}
			},
			{
				"@type": "Question",
				"name": "What mechanics does GameLayer support?",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "GameLayer supports 10+ gamification mechanics including Missions, Streaks, Achievements, Level-Ups, Leaderboards, Mystery Wins, Prizes, Raffles, Quizzes, and Virtual Currencies. All mechanics are accessible via REST API endpoints and can be combined to build custom engagement systems."
				}
			},
			{
				"@type": "Question",
				"name": "Can we run loyalty programmes with GameLayer?",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "Yes. GameLayer is designed for digital engagement, loyalty, and retention programs. The API provides mechanics like missions, rewards, level-ups, and virtual currencies that are commonly used in loyalty programs. Teams maintain full control over the user experience while GameLayer handles the underlying rules and state management."
				}
			},
			{
				"@type": "Question",
				"name": "How do rules and budgets work?",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "GameLayer includes a Rules Manager that allows teams to define conditions, budgets, and eligibility criteria for mechanics. Rules can target specific player outcomes and control reward distribution, progression thresholds, and mechanic interactions. All rules are managed via API and dashboard."
				}
			},
			{
				"@type": "Question",
				"name": "How do developers integrate?",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "Developers integrate GameLayer via REST API. The platform provides 50+ endpoints for missions, streaks, leaderboards, rewards, achievements, and other mechanics. Integration typically involves authenticating with an API key, sending events to trigger mechanics, and querying player state. Full API documentation is available at /api-docs."
				}
			},
			{
				"@type": "Question",
				"name": "ما هي منصة التلعيب؟",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "منصة التلعيب هي نظام يستخدم المهام، المكافآت، ولوحات الصدارة لزيادة تفاعل المستخدمين وولائهم داخل المنتجات الرقمية."
				}
			},
			{
				"@type": "Question",
				"name": "كيف تساعد أنظمة المكافآت على زيادة التفاعل؟",
				"acceptedAnswer": {
					"@type": "Answer",
					"text": "أنظمة المكافآت تحفّز المستخدمين على تكرار السلوكيات المرغوبة من خلال النقاط، الجوائز، والتقدم داخل التجربة الرقمية."
				}
			}
		]
	},
	// ItemList of on-page sections
	{
		"@context": "https://schema.org",
		"@type": "ItemList",
		"name": "GameLayer Homepage Sections",
		"itemListElement": [
			{
				"@type": "ListItem",
				"position": 1,
				"name": "Gamification Mechanics",
				"url": `${siteUrl}/#mechanics`
			},
			{
				"@type": "ListItem",
				"position": 2,
				"name": "Powered by GameLayer",
				"url": `${siteUrl}/#powered-by`
			},
			{
				"@type": "ListItem",
				"position": 3,
				"name": "Why Companies Love GameLayer",
				"url": `${siteUrl}/#why`
			},
			{
				"@type": "ListItem",
				"position": 4,
				"name": "Pricing",
				"url": `${siteUrl}/#pricing`
			},
			{
				"@type": "ListItem",
				"position": 5,
				"name": "Get Started",
				"url": `${siteUrl}/#get-started`
			}
		]
	}
];
---

<Layout 
	title={seo.title}
	description={seo.description}
	arabicDescription={defaultHomeSeo.arabicDescription}
	keywords="gamification API, gamification platform, user engagement, user retention, customer loyalty, gamification mechanics, API integration, gamification software"
	canonical={seo.canonical}
	schema={schemas}
>
	<main id="main-content" class="page gl-typography">
		<Header />
		<div class="section hero">
			<Hero />
		</div>
		<StickySection />
		<BusinessOutcomes />
		<Showcase />
		<div class="section section--card">
			<WhyCompaniesFinal />
		</div>
		<div id="pricing" class="section section--plain pricing-section">
			<div class="container">
				<div class="pricing-header">
					<h2>Simple, transparent pricing</h2>
					<p>
						Choose a plan based on programme size — not features. Every plan includes full access to GameLayer's engagement mechanics.
					</p>
				</div>
				<Pricing hideHeader />
			</div>
		</div>
		<section id="get-started" class="section section--card final-cta">
			<div class="container">
				<div class="final-cta-card">
					<div class="final-cta-grid">
						<div class="final-cta-image">
							<picture>
								<source 
									type="image/webp" 
									srcset={ctaImages.webp.src}
								/>
								<img 
									src={ctaImages.original.src} 
									alt="GameLayer gamification platform - digital engagement and loyalty points system" 
									loading="lazy"
									decoding="async"
									width="420"
									height="420"
								/>
							</picture>
						</div>
						<div class="final-cta-content">
							<h2>Start building engagement that lasts</h2>
							<p>
								Whether you're experimenting or scaling in production, GameLayer gives you the tools to design engagement mechanics that fit your product - quickly and safely.
							</p>
							<div class="final-cta-actions">
								<!-- Get API Key: EXTERNAL_URLS.CMS_DASHBOARD -->
								<a 
									href={EXTERNAL_URLS.CMS_DASHBOARD} 
									target="_blank" 
									rel="noopener noreferrer external" 
									class="button button-primary" 
									aria-label="Get API key for GameLayer (external)"
								>
									Get API Key
								</a>
								<!-- View API Docs: /api-docs -->
								<a 
									href="/api-docs" 
									class="button" 
									aria-label="View GameLayer API documentation"
								>
									View API Docs
								</a>
							</div>
							<p class="final-cta-footnote">Free plan includes usage limits - No credit card required</p>
						</div>
					</div>
				</div>
			</div>
		</section>
		<Footer />
	</main>
</Layout>

<style>
	main{
		background-color: var(--page-bg);
	}

	.pricing-section {
		background: #F6F8FC; /* soft tinted background like Step-Up */
		/* Padding inherited from .section--plain: var(--gl-section-padding-standard) */
		/* DIAGNOSTIC: Run in DevTools console to check computed spacing:
		   (() => {
		     const powered = document.querySelector('#powered-by');
		     const pricing = document.querySelector('.pricing-section');
		     const ph = document.querySelector('.pricing-header');
		     const pbHeader = document.querySelector('.powered-by-header');
		     const cs = (el) => el ? getComputedStyle(el) : null;
		     console.table({
		       powered_paddingTop: cs(powered)?.paddingTop,
		       powered_paddingBottom: cs(powered)?.paddingBottom,
		       powered_header_marginTop: cs(pbHeader)?.marginTop,
		       powered_header_marginBottom: cs(pbHeader)?.marginBottom,
		       pricing_paddingTop: cs(pricing)?.paddingTop,
		       pricing_paddingBottom: cs(pricing)?.paddingBottom,
		       pricing_header_marginTop: cs(ph)?.marginTop,
		       pricing_header_marginBottom: cs(ph)?.marginBottom,
		     });
		   })(); */
	}

	.pricing-header {
		text-align: center;
		max-width: 720px;
		margin: 0 auto 50px;
		margin-top: 0;
	}

	.pricing-header h2 {
		text-align: center;
		margin-top: 0;
	}

	/* Reset first child margin to prevent extra top gap */
	.pricing-section .container > :first-child {
		margin-top: 0 !important;
	}

	.pricing-header p {
		text-align: center;
		margin-left: auto;
		margin-right: auto;
		margin-top: 12px;
	}

	/* Make Pricing component's section background transparent */
	.pricing-section section.pricing-section {
		background-color: transparent;
		padding: 0;
	}

	/* Final CTA Section */
	.final-cta {
		padding: var(--gl-section-padding-standard) 0;
		background: var(--page-bg);
	}

	.final-cta-card {
		background: white;
		border-radius: 28px;
		padding: clamp(24px, 4vw, 32px);
		box-shadow: 0 20px 40px rgba(0, 0, 0, 0.04);
		max-width: 960px;
		margin: 0 auto;
	}

	.final-cta-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		align-items: center;
		gap: clamp(32px, 4vw, 48px);
	}

	.final-cta-image {
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.final-cta-image img {
		width: 80%;
		height: auto;
		transition: transform 180ms ease-out, box-shadow 180ms ease-out;
		border-radius: 12px;
		/* Multi-layer soft shadow system similar to hero image */
		box-shadow: 
			0 4px 12px rgba(0, 0, 0, 0.06),
			0 12px 32px rgba(0, 0, 0, 0.08),
			0 24px 64px rgba(0, 0, 0, 0.06);
	}

	.final-cta-image:hover img {
		transform: translateY(-2px);
		box-shadow: 
			0 6px 16px rgba(0, 0, 0, 0.08),
			0 16px 40px rgba(0, 0, 0, 0.10),
			0 32px 80px rgba(0, 0, 0, 0.08);
	}

	.final-cta-image img:focus-visible {
		outline: 2px solid var(--as-accent, #2563eb);
		outline-offset: 4px;
		border-radius: 16px;
	}

	/* Respect reduced motion preference */
	@media (prefers-reduced-motion: reduce) {
		.final-cta-image img {
			transition: box-shadow 180ms ease-out;
		}
		
		.final-cta-image:hover img {
			transform: none;
		}
	}

	@media (max-width: 768px) {
		.final-cta-image img {
			/* Lighter shadow stack on mobile */
			box-shadow: 
				0 2px 6px rgba(0, 0, 0, 0.03),
				0 6px 16px rgba(0, 0, 0, 0.04);
		}

		.final-cta-image:hover img {
			box-shadow: 
				0 4px 10px rgba(0, 0, 0, 0.05),
				0 10px 24px rgba(0, 0, 0, 0.06);
		}
	}

	.final-cta-content {
		max-width: 520px;
	}

	.final-cta-content h2 {
		font-size: var(--gl-h2-size);
		font-weight: var(--gl-h2-weight);
		line-height: var(--gl-h2-line-height);
		letter-spacing: -0.02em;
		margin: 0 0 var(--gl-h2-margin-bottom);
		color: var(--as-black);
		word-wrap: break-word;
		overflow-wrap: break-word;
	}

	.final-cta-content > p {
		font-size: var(--gl-lede-size);
		font-weight: var(--gl-lede-weight);
		line-height: var(--gl-lede-line-height);
		color: var(--gl-lede-color);
		max-width: var(--gl-lede-max-width);
		margin: var(--gl-heading-lede-gap-top) 0 var(--gl-lede-content-gap);
		word-wrap: break-word;
		overflow-wrap: break-word;
	}

	.final-cta-actions {
		display: flex;
		gap: 14px;
		flex-wrap: wrap;
		margin-bottom: 12px;
	}

	.final-cta-content .final-cta-footnote {
		font-size: 15px !important;
		font-style: italic;
		line-height: 1.5;
		color: var(--as-black);
		opacity: 0.65;
		margin: 0;
	}

	@media (max-width: 768px) {
		.final-cta-grid {
			grid-template-columns: 1fr;
			gap: 32px;
		}

		.final-cta-image {
			order: -1;
		}

		.final-cta-image img {
			width: 70%;
		}

		.final-cta-content {
			text-align: center;
			max-width: 100%;
		}

		.final-cta-actions {
			flex-direction: column;
			align-items: stretch;
		}

		.final-cta-actions .button {
			width: 100%;
		}
	}

	@media (max-width: 480px) {
		.final-cta-image img {
			width: 60%;
			transform: none;
		}
	}

</style>