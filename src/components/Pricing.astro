---
import { EXTERNAL_EMAILS } from '../lib/external';

const { hideHeader = false } = Astro.props;

// Payment logos
const StripeLogo = '/Stripe_Logo.svg';
const GoCardlessLogo = '/GoCardless_Logo.svg';

// Growth view - first 4 tiers
const growthPlans = [
  {
    name: "Starter",
    price: "€100",
    period: "month",
    features: [
      "Up to 1,000 active users",
      "Support: Email",
      "Conceptual support: Not included",
      "Analytics: Dashboard"
    ]
  },
  {
    name: "Essentials",
    price: "€500",
    period: "month",
    features: [
      "Up to 10,000 active users",
      "Support: Email",
      "Conceptual support: Not included",
      "Analytics: Dashboard"
    ]
  },
  {
    name: "Advanced",
    price: "€1,000",
    period: "month",
    features: [
      "Up to 25,000 active users",
      "Support: Email",
      "Conceptual support: Not included",
      "Analytics: Dashboard"
    ]
  },
  {
    name: "Professional",
    price: "€1,500",
    period: "month",
    features: [
      "Up to 50,000 active users",
      "Support: Slack",
      "Conceptual support: Not included",
      "Analytics: Weekly insights & monthly recommendations"
    ]
  }
];

// Scale view - next 4 tiers
const scalePlans = [
  {
    name: "Scale",
    price: "€2,000",
    period: "month",
    features: [
      "Up to 100,000 active users",
      "Support: Slack",
      "Conceptual support: Included (on request)",
      "Analytics: Weekly insights & monthly recommendations"
    ]
  },
  {
    name: "Scale Plus",
    price: "€3,500",
    period: "month",
    features: [
      "Up to 250,000 active users",
      "Support: Slack",
      "Conceptual support: Included (on request)",
      "Analytics: Weekly insights & monthly recommendations"
    ]
  },
  {
    name: "Hyper Scale",
    price: "€6,000",
    period: "month",
    features: [
      "Up to 500,000 active users",
      "Support: Bespoke",
      "Conceptual support: Included (on request)",
      "Analytics: Bespoke"
    ]
  },
  {
    name: "Mass Scale",
    price: "€10,000",
    period: "month",
    features: [
      "Up to 1,000,000 active users",
      "Support: Bespoke",
      "Conceptual support: Included (on request)",
      "Analytics: Bespoke"
    ]
  }
];
---

<div class="pricing-content">
    {!hideHeader && (
        <div class="pricing-header">
            <h2>Simple, transparent pricing</h2>
            <p>Choose a plan based on scale - not features. Every plan includes full and unlimited access to GameLayer's engagement mechanics — pricing simply reflects usage as your product grows.</p>
        </div>
    )}

    <div class="pricing-toggle-wrapper">
        <div class="pricing-toggle" role="tablist" aria-label="Pricing view selector">
            <button 
                class="pricing-toggle-option active" 
                data-view="growth" 
                role="tab" 
                aria-selected="true" 
                aria-controls="pricing-grid-container pricing-grid-container-scale"
                id="toggle-growth"
            >
                Build
            </button>
            <button 
                class="pricing-toggle-option" 
                data-view="scale" 
                role="tab" 
                aria-selected="false" 
                aria-controls="pricing-grid-container pricing-grid-container-scale"
                id="toggle-scale"
            >
                Scale
            </button>
        </div>
    </div>

    <div class="pricing-toggle-description">Build: up to 50k users | Scale: 100k - 1m users</div>
    
    <div class="pricing-grid-wrapper">
        <div id="pricing-grid-container" class="pricing-grid-container" data-view="growth">
            <div class="pricing-grid">
                {growthPlans.map((plan) => (
            <div class="pricing-card">
                <div class="pricing-card-header">
                    <h3 class="pricing-title">{plan.name}</h3>
                    <div class="pricing-price">
                        <span class="price">{plan.price}</span>
                        {plan.period && <span class="period">{plan.period}</span>}
                    </div>
                </div>
                
                <div class="pricing-features">
                    <ul>
                        {plan.features.map((feature) => {
                            const isSupport = feature.startsWith('Support:');
                            const isConceptualSupport = feature.startsWith('Conceptual support:');
                            const isAnalytics = feature.startsWith('Analytics:');
                            const isActiveUsers = feature.includes('active users');
                            return (
                                <li class={`feature-item ${isActiveUsers ? '' : 'feature-item-meta'}`}>
                                    {!isActiveUsers && <span class="bullet-point">•</span>}
                                    <span class="feature-text">
                                        {isSupport ? (
                                            <>
                                                <strong>Support:</strong> {feature.replace('Support:', '').trim()}
                                            </>
                                        ) : isConceptualSupport ? (
                                            <>
                                                <strong>Conceptual support:</strong> {feature.replace('Conceptual support:', '').trim()}
                                            </>
                                        ) : isAnalytics ? (
                                            <>
                                                <strong>Analytics:</strong> {feature.replace('Analytics:', '').trim()}
                                            </>
                                        ) : isActiveUsers ? (
                                            <>
                                                Up to <strong>{feature.replace('Up to ', '').trim()}</strong>
                                            </>
                                        ) : (
                                            feature
                                        )}
                                    </span>
                                </li>
                            );
                        })}
                    </ul>
                </div>
                
                <div class="pricing-cta">
                    <a 
                        href={`mailto:${EXTERNAL_EMAILS.SALES}?subject=GameLayer%3A%20${plan.name}%20Plan%20Enquiry`} 
                        target="_self" 
                        class="button button-primary"
                    >
                        Contact Us
                    </a>
                </div>
            </div>
                ))}
            </div>
        </div>
        <div id="pricing-grid-container-scale" class="pricing-grid-container" data-view="scale" aria-hidden="true">
            <div class="pricing-grid">
                {scalePlans.map((plan) => (
            <div class="pricing-card">
                <div class="pricing-card-header">
                    <h3 class="pricing-title">{plan.name}</h3>
                    <div class="pricing-price">
                        <span class="price">{plan.price}</span>
                        {plan.period && <span class="period">{plan.period}</span>}
                    </div>
                </div>
                
                <div class="pricing-features">
                    <ul>
                        {plan.features.map((feature) => {
                            const isSupport = feature.startsWith('Support:');
                            const isConceptualSupport = feature.startsWith('Conceptual support:');
                            const isAnalytics = feature.startsWith('Analytics:');
                            const isActiveUsers = feature.includes('active users');
                            return (
                                <li class={`feature-item ${isActiveUsers ? '' : 'feature-item-meta'}`}>
                                    {!isActiveUsers && <span class="bullet-point">•</span>}
                                    <span class="feature-text">
                                        {isSupport ? (
                                            <>
                                                <strong>Support:</strong> {feature.replace('Support:', '').trim()}
                                            </>
                                        ) : isConceptualSupport ? (
                                            <>
                                                <strong>Conceptual support:</strong> {feature.replace('Conceptual support:', '').trim()}
                                            </>
                                        ) : isAnalytics ? (
                                            <>
                                                <strong>Analytics:</strong> {feature.replace('Analytics:', '').trim()}
                                            </>
                                        ) : isActiveUsers ? (
                                            <>
                                                Up to <strong>{feature.replace('Up to ', '').trim()}</strong>
                                            </>
                                        ) : (
                                            feature
                                        )}
                                    </span>
                                </li>
                            );
                        })}
                    </ul>
                </div>
                
                <div class="pricing-cta">
                    <a 
                        href={`mailto:${EXTERNAL_EMAILS.SALES}?subject=GameLayer%3A%20${plan.name}%20Plan%20Enquiry`} 
                        target="_self" 
                        class="button button-primary"
                    >
                        Contact Us
                    </a>
                </div>
            </div>
                ))}
            </div>
        </div>
    </div>

    <div class="pricing-footnote">Free plan available for testing and prototyping - up to 100 users</div>

    <div class="pricing-payments" aria-label="Payments">
        <div class="pricing-payments__content">
            <p class="pricing-payments__text">
                Card payments via <img src={StripeLogo} alt="Stripe" class="pay-brand-logo" loading="lazy" decoding="async" /> and bank payments via <img src={GoCardlessLogo} alt="GoCardless" class="pay-brand-logo" loading="lazy" decoding="async" /><br />
                Contact us and we'll send a secure payment link to activate your plan
            </p>
        </div>
    </div>
</div>


<style>
    .pricing-content {
        width: 100%;
    }

    .pricing-header {
        max-width: 720px;
        margin: 0 auto 26px;
        text-align: center;
    }

    .pricing-header h2 {
        font-size: var(--gl-h2-size);
        font-weight: var(--gl-h2-weight);
        line-height: var(--gl-h2-line-height);
        letter-spacing: -0.02em;
        margin: 0 auto var(--gl-h2-margin-bottom);
        color: var(--as-black);
        text-align: center;
    }

    .pricing-header p {
        font-size: var(--gl-lede-size);
        font-weight: var(--gl-lede-weight);
        line-height: var(--gl-lede-line-height);
        color: var(--gl-lede-color);
        margin: var(--gl-heading-lede-gap-top) auto 0;
        max-width: var(--gl-lede-max-width);
        text-align: center;
    }

    /* Pricing Toggle */
    .pricing-toggle-wrapper {
        display: flex;
        justify-content: center;
        margin-bottom: 32px;
    }

    .pricing-toggle {
        display: inline-flex;
        background: rgba(15, 23, 42, 0.04);
        border: 1px solid rgba(15, 23, 42, 0.10);
        border-radius: 999px;
        padding: 2px;
        gap: 2px;
    }

    .pricing-toggle-option {
        background: transparent;
        border: none;
        padding: 4px 12px;
        font-size: 13px;
        font-weight: 600;
        color: rgba(15, 23, 42, 0.65);
        border-radius: 999px;
        cursor: pointer;
        transition: all 160ms ease;
        font-family: inherit;
        position: relative;
    }

    .pricing-toggle-option:hover {
        color: rgba(15, 23, 42, 0.85);
    }

    .pricing-toggle-option.active {
        background: #fff;
        color: var(--as-black);
        box-shadow: 0 1px 4px rgba(15, 23, 42, 0.08);
    }

    .pricing-toggle-option:focus-visible {
        outline: 2px solid var(--as-accent);
        outline-offset: 2px;
    }

    /* Pricing Grid Wrapper */
    .pricing-grid-wrapper {
        position: relative;
        width: 100%;
        min-height: 400px;
    }

    .pricing-grid-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        opacity: 0;
        transform: translateY(6px);
        pointer-events: none;
        transition: opacity 250ms ease-out, transform 250ms ease-out;
    }

    .pricing-grid-container.active {
        position: relative;
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
    }

    .pricing-grid-container:not(.active) {
        position: absolute;
        opacity: 0;
        transform: translateY(6px);
        pointer-events: none;
    }

    @media (prefers-reduced-motion: reduce) {
        .pricing-grid-container {
            transition: none;
            transform: none;
        }
        
        .pricing-grid-container[aria-hidden="true"] {
            transform: none;
        }
    }

    .pricing-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 18px;
        align-items: stretch;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        box-sizing: border-box;
    }

    .pricing-toggle-description {
        margin-top: 12px;
        margin-bottom: 24px;
        text-align: center;
        font-size: 15px;
        font-style: italic;
        opacity: 0.65;
    }

    .pricing-footnote {
        margin-top: 32px;
        text-align: center;
        font-size: 15px;
        font-style: italic;
        opacity: 0.65;
    }

    .pricing-card {
        background: #fff;
        border: 1px solid rgba(15, 23, 42, 0.10);
        border-radius: 22px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
        padding: 32px;
        display: flex;
        flex-direction: column;
        height: 100%;
        transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
        box-sizing: border-box;
        width: 100%;
        max-width: 100%;
    }

    .pricing-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 40px rgba(15, 23, 42, 0.08);
        border-color: rgba(15, 23, 42, 0.12);
    }

    .pricing-card-header {
        text-align: center;
        margin-bottom: var(--gl-card-content-gap);
    }

    .pricing-title {
        margin: 0 0 var(--gl-h3-margin-bottom);
        font-size: var(--gl-h3-size);
        font-weight: var(--gl-h3-weight);
        line-height: var(--gl-h3-line-height);
        line-height: 1.1;
        color: var(--color-text);
    }

    .pricing-price {
        margin: 0;
        text-align: center;
        display: flex;
        align-items: baseline;
        justify-content: center;
        gap: 6px;
    }

    .price {
        font-size: 48px;
        font-weight: 900;
        letter-spacing: -0.02em;
        color: var(--color-text);
        line-height: 1;
    }

    .period {
        font-size: 13px;
        opacity: 0.7;
        color: var(--color-text);
    }

    .pricing-limit {
        margin: 0 0 18px;
        font-size: 14px;
        opacity: 0.8;
        color: rgba(15, 23, 42, 0.85);
        text-align: center;
    }

    .users {
        color: var(--color-text-muted);
        font-size: 14px;
        opacity: 0.75;
        margin: 0 0 18px;
    }

    .pricing-features {
        flex-grow: 1;
        margin: 0;
        margin-top: 24px;
    }

    .pricing-features ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: var(--gl-list-item-gap);
        color: rgba(15, 23, 42, 0.86);
    }

    .feature-item {
        display: flex;
        align-items: flex-start;
        gap: var(--gl-card-content-gap);
        line-height: var(--gl-body-line-height);
        color: var(--gl-body-color);
        font-size: 16px;
        font-weight: var(--gl-body-weight);
    }

    .feature-item-meta {
        font-size: 15px;
        font-style: italic;
        color: #9ca3af;
    }

    .feature-text {
        flex: 1;
    }

    .bullet-point {
        margin-top: 2px;
        flex-shrink: 0;
        color: rgba(15, 23, 42, 0.86);
        font-size: 16px;
        line-height: 1;
    }

    .feature-item-meta .bullet-point {
        font-size: 15px;
        color: #9ca3af;
    }

    .pricing-cta {
        margin-top: auto;
        padding-top: 20px;
    }

    .pricing-cta {
        margin-top: auto;
        padding-top: 20px;
        display: flex;
        justify-content: center;
    }

    .pricing-cta .button {
        width: auto;
        min-width: 140px;
    }

    /* Secondary button - Bank Account */
    .button-bank {
        background: rgba(0, 0, 0, 0.03);
        color: var(--color-text);
        border: none;
        box-shadow: none;
    }

    .button-bank:hover {
        background: rgba(0, 0, 0, 0.07);
        color: var(--color-text);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .button-bank:active {
        transform: translateY(0);
        background: rgba(0, 0, 0, 0.05);
    }

    .pricing-cta .button svg {
        flex-shrink: 0;
        opacity: 0.9;
    }

    .pricing-cta .button:hover svg {
        opacity: 1;
    }

    @media (max-width: 1024px) {
        .pricing-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    @media (max-width: 640px) {
        .pricing-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .pricing-card {
            padding: 22px;
            min-width: 0;
        }

        .pricing-title {
            font-size: 26px;
        }

        .price {
            font-size: 44px;
        }

    }

    @media (max-width: 480px) {
        .pricing-section {
            padding: 60px 0;
        }
        
        .value-framing {
            font-size: 1.4rem;
            margin-top: 1rem;
            padding: 0 1rem;
        }
    }

    /* Payments Trust Row */
    .pricing-payments {
        margin-top: 18px;
        width: 100%;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        display: flex;
        justify-content: center;
    }

    .pricing-payments__content {
        background: rgba(15, 23, 42, 0.03);
        border: 1px solid rgba(15, 23, 42, 0.06);
        border-radius: 16px;
        padding: 14px 16px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .pricing-payments__text {
        margin: 0;
        font-size: 14px;
        line-height: 1.5;
        opacity: 0.85;
        color: rgba(15, 23, 42, 0.85);
        text-align: center;
    }

    .pay-brand-logo {
        height: 18px;
        vertical-align: middle;
        margin: 0 4px;
        display: inline-block;
        object-fit: contain;
    }

    @media (max-width: 640px) {
        .pricing-card {
            padding: 22px;
        }

        .pricing-payments__content {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
    }

    @media (max-width: 640px) {
        .pricing-toggle-wrapper {
            margin-bottom: 24px;
        }

        .pricing-toggle-option {
            padding: 8px 16px;
            font-size: 14px;
        }
    }
</style>

<script>
    // Pricing View Toggle
    document.addEventListener('DOMContentLoaded', function() {
        const toggleButtons = document.querySelectorAll('.pricing-toggle-option');
        const growthContainer = document.getElementById('pricing-grid-container');
        const scaleContainer = document.getElementById('pricing-grid-container-scale');
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        
        if (!toggleButtons.length || !growthContainer || !scaleContainer) return;
        
        function switchView(view) {
            const isGrowth = view === 'growth';
            
            // Update toggle buttons
            toggleButtons.forEach(btn => {
                const isActive = btn.dataset.view === view;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });
            
            // Update containers with active class and aria-hidden
            if (isGrowth) {
                growthContainer.classList.add('active');
                growthContainer.removeAttribute('aria-hidden');
                scaleContainer.classList.remove('active');
                scaleContainer.setAttribute('aria-hidden', 'true');
            } else {
                growthContainer.classList.remove('active');
                growthContainer.setAttribute('aria-hidden', 'true');
                scaleContainer.classList.add('active');
                scaleContainer.removeAttribute('aria-hidden');
            }
        }
        
        // Initialize - ensure growth is visible
        growthContainer.classList.add('active');
        switchView('growth');
        
        // Add click handlers
        toggleButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const view = this.dataset.view;
                switchView(view);
            });
        });
    });
</script>



