---

import GameLayerLogo from '../images/gamelayer_logo_sm.png'
import { EXTERNAL_URLS } from '../lib/external'
---

<header class="gl-header" data-gl="header">
    <div class="gl-container">
        <div class="header-inner">
            <a class="gl-header__brand" href="/" aria-label="GameLayer - Gamification API Platform" data-gl="brand">
                <img class="gl-header__logo" src={GameLayerLogo.src} alt="GameLayer - Gamification API platform for user engagement and customer loyalty" width="150" height="40" loading="eager" fetchpriority="high" decoding="async">
            </a>

            <nav class="gl-header__nav nav-desktop" aria-label="Primary" data-gl="nav">
                <a href="#pricing" aria-label="Gamification platform pricing plans">Pricing</a>
                <a href="/api-docs" aria-label="GameLayer API documentation">API</a>
                <a href="https://gl-assets.vercel.app/" target="_blank" rel="noopener noreferrer" aria-label="GameLayer demo">Demo</a>
                <a href="/blog" aria-label="Gamification insights and strategies">Blog</a>
            </nav>

            <div class="gl-header__cta" data-gl="cta">
                <button class="nav-toggle" type="button" aria-label="Open menu">
                    <span class="hamburger" aria-hidden="true"><span></span></span>
                </button>
                
                <a class="button button-primary cta-desktop" href={EXTERNAL_URLS.CMS_DASHBOARD} target="_blank" rel="noopener noreferrer external" aria-label="Open GameLayer dashboard (external)">Sign Up Free</a>
            </div>
        </div>
    </div>

    <div id="mobile-nav" class="nav-mobile" hidden>
        <div class="nav-mobile-inner container">
            <a href="#pricing" aria-label="Gamification platform pricing plans">Pricing</a>
            <a href="/api-docs" aria-label="GameLayer API documentation">API</a>
            <a href="https://gl-assets.vercel.app/" target="_blank" rel="noopener noreferrer" aria-label="GameLayer demo">Demo</a>
            <a href="/blog" aria-label="Gamification insights and strategies">Blog</a>
            <a class="button button-primary" href={EXTERNAL_URLS.CMS_DASHBOARD} target="_blank" rel="noopener noreferrer external" aria-label="Open GameLayer dashboard (external)">Sign Up Free</a>
        </div>
    </div>
</header>

<script defer>
    (function() {
        const toggle = document.querySelector('.nav-toggle') as HTMLButtonElement | null;
        const mobileNav = document.getElementById('mobile-nav') as HTMLElement | null;
        const header = document.querySelector('.gl-header') as HTMLElement | null;
        
        if (!toggle || !mobileNav) return;
        
        function closeMenu() {
            if (!mobileNav || !toggle) return;
            mobileNav.hidden = true;
            toggle.setAttribute('aria-expanded', 'false');
            toggle.setAttribute('aria-label', 'Open menu');
            if (header) {
                header.classList.remove('menu-open');
            }
        }
        
        function openMenu() {
            if (!mobileNav || !toggle) return;
            mobileNav.hidden = false;
            toggle.setAttribute('aria-expanded', 'true');
            toggle.setAttribute('aria-label', 'Close menu');
            if (header) {
                header.classList.add('menu-open');
            }
        }
        
        toggle.addEventListener('click', function() {
            if (mobileNav && mobileNav.hidden) {
                openMenu();
            } else {
                closeMenu();
            }
        });
        
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && mobileNav && !mobileNav.hidden && toggle) {
                closeMenu();
                toggle.focus();
            }
        });
        
        // Close when clicking a link
        const mobileLinks = mobileNav.querySelectorAll('a');
        mobileLinks.forEach(link => {
            link.addEventListener('click', closeMenu);
        });
        
        // Close when clicking outside (optional)
        document.addEventListener('click', function(e) {
            if (mobileNav && toggle && !mobileNav.hidden && e.target) {
                const target = e.target as Node;
                if (!mobileNav.contains(target) && !toggle.contains(target)) {
                    closeMenu();
                }
            }
        });
    })();
</script>

<style lang="scss"> 

.gl-header {
    display: block !important;     /* prevents global header{display:flex} from taking over */
    height: auto !important;
    background: var(--surface, #ffffff);
    border-bottom: 1px solid rgba(0,0,0,0.08);
}

/* Header container: no vertical padding (inherits horizontal padding from .gl-container) */
.gl-header .gl-container {
    padding-block: 0 !important;
}

.header-inner {
    min-height: 64px;
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    column-gap: 24px;
    padding-left: 0;
    padding-right: 0;
}

.gl-header__brand {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    margin: 0;
    padding: 0;
}

.gl-header__logo {
    height: 40px;
    width: auto;
    max-height: none;
    display: block;
    margin: 0;
    padding: 0;
}

.gl-header__nav {
    display: flex;
    align-items: center;
    gap: 28px;
    justify-content: center;
}

.gl-header__nav a {
    font-size: 15px;
    font-weight: 600;
    line-height: 1.2;
    text-decoration: none;
    color: #111;
    letter-spacing: -0.01em;
    padding: 6px 12px;
    border-radius: 999px;
    transition: color 150ms ease-out;
    position: relative;
}

.gl-header__nav a:hover,
.gl-header__nav a:focus {
    color: var(--as-accent, #2563EB);
    background-color: transparent;
    text-decoration: none;
}

.gl-header__nav a.active,
.gl-header__nav a[aria-current="page"] {
    color: var(--as-accent, #2563EB);
}

.gl-header__cta {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 0;
    margin-left: 28px; /* Match nav gap (28px) for visual anchoring */
}

/* force CTA to center visually */
.gl-header__cta .cta-desktop {
    height: 40px;
    padding: 0 20px;
    line-height: 1 !important;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    border-radius: 999px;
    font-size: 14px;
}

/* ensure hover effect matches global button-primary hover */
.gl-header__cta .cta-desktop:hover {
    opacity: 0.95;
    box-shadow: 0 0 0 5px var(--as-plum);
}

/* remove any accidental margins affecting vertical alignment */
.gl-header__cta .cta-desktop,
.gl-header__brand img {
    margin: 0;
}

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.nav-toggle {
    width: 44px;
    height: 44px;
    border: 0;
    background: transparent;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.hamburger {
    width: 22px;
    height: 14px;
    position: relative;
    display: inline-block;
}

.hamburger::before,
.hamburger::after,
.hamburger > span {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: #000;
    border-radius: 2px;
}

.hamburger::before {
    top: 0;
}

.hamburger > span {
    top: 6px;
}

.hamburger::after {
    bottom: 0;
}

/* Animate to X when menu is open */
.menu-open .hamburger::before {
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
}

.menu-open .hamburger::after {
    bottom: auto;
    top: 50%;
    transform: translateY(-50%) rotate(-45deg);
}

.menu-open .hamburger > span {
    opacity: 0;
}

.nav-mobile {
    display: none;
    background: var(--surface);
    border-top: 1px solid var(--stroke);
    width: 100%;
}

.nav-mobile[hidden] {
    display: none !important;
}

.nav-mobile-inner {
    padding-top: 12px;
    padding-bottom: 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-items: flex-end;
}

.nav-mobile-inner a {
    display: block;
    padding: 12px 0;
    font-size: 16px;
    font-weight: 600;
    line-height: 1.3;
    text-decoration: none;
    color: #111;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    text-align: right;
    letter-spacing: -0.01em;
    transition: color 150ms ease-out;
}

.nav-mobile-inner a:hover,
.nav-mobile-inner a:focus {
    color: var(--as-accent, #2563EB);
}

.nav-mobile-inner a.active,
.nav-mobile-inner a[aria-current="page"] {
    color: var(--as-accent, #2563EB);
}

.nav-mobile-inner a:last-child:not(.button) {
    margin-top: 8px;
    border-bottom: none;
    padding: 12px 0;
}

.nav-mobile-inner .button {
    width: auto;
    justify-content: center;
    padding: 0 24px !important;
    height: 56px;
    display: inline-flex;
    align-items: center;
    margin-top: 8px;
}

.nav-mobile-inner .button.button-primary {
    color: #fff !important;
}

.nav-mobile-inner .button.button-primary:hover {
    opacity: 0.95;
    box-shadow: 0 0 0 5px var(--as-plum);
}

@media (max-width: 768px) {
    .nav-desktop {
        display: none;
    }
    
    .cta-desktop {
        display: none !important;
    }
    
    .nav-toggle {
        display: inline-flex;
    }
    
    .nav-mobile {
        display: block;
    }
    
    .gl-header__cta {
        gap: 0;
        justify-content: flex-end;
    }
}

@media (min-width: 769px) {
    .nav-toggle {
        display: none;
    }
}

</style>